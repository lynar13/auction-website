import{r as d,a as m,u}from"./profile-BS-rOZAm.js";import"./app-BkoDK6iS.js";async function g(i,n=3,o=2e3){const s="66768252f49364f",r="https://api.imgur.com/3/image";for(let e=1;e<=n;e++)try{const a=new FormData;a.append("image",i);const t=await fetch(r,{method:"POST",headers:{Authorization:`Client-ID ${s}`},body:a});if(!t.ok){const l=await t.json();throw new Error(l.data?.error||"Failed to upload image to Imgur")}return(await t.json()).data.link}catch(a){if(console.error(`Attempt ${e}: ${a.message}`),e<n)console.log(`Retrying in ${o/1e3} seconds...`),await new Promise(t=>setTimeout(t,o));else throw new Error("All attempts to upload the image to Imgur have failed. Please try again later.")}}document.addEventListener("DOMContentLoaded",async()=>{const i=localStorage.getItem("token"),n=JSON.parse(localStorage.getItem("user"));if(!i||!n||!n.name){alert("You must log in to access your profile."),window.location.href="../auth/login/index.html";return}try{const e=(await d(n.name)).data;if(e){const{name:a,email:t,avatar:c,credits:l,_count:p}=e;localStorage.setItem("user",JSON.stringify(e)),document.getElementById("username").textContent=a||"Unknown User",document.getElementById("avatar").src=c?.url||"https://raw.githubusercontent.com/lynar13/images/main/banana.jpg",document.getElementById("credits").textContent=`Credits: ${l||0}`}else throw new Error("Profile data structure is incorrect.")}catch(r){console.error("Error reading profile:",r.message),document.getElementById("credits").textContent="Credits: Unavailable"}try{const e=(await m(n.name)).data||[],a=document.getElementById("userListings");a.innerHTML=e.length?e.map(t=>`
          <div class="card">
            <img src="${t.media?.[0]?.url||"https://via.placeholder.com/400"}" alt="${t.title}" class="card-img-top">
            <div class="card-body">
              <h5 class="card-title">${t.title}</h5>
              <p class="card-text">${t.description||"No description available"}</p>
              <a href="../listing/index.html?id=${t.id}" class="btn btn-primary">View Listing</a>
            </div>
          </div>
        `).join(""):"<p>No listings found.</p>"}catch(r){console.error("Error fetching user listings:",r.message),document.getElementById("userListings").innerHTML="<p>Error loading listings. Please try again later.</p>"}const o=document.getElementById("avatarInput"),s=document.getElementById("updateAvatarButton");s&&o?(s.addEventListener("click",()=>o.click()),o.addEventListener("change",async()=>{const r=o.files[0];if(!r){alert("Please select an image to upload.");return}try{document.getElementById("avatar").alt="Uploading...";const e=await g(r),a=await u(n.name,{avatar:{url:e,alt:"User avatar"}});if(a?.avatar?.url)document.getElementById("avatar").src=a.avatar.url,alert("Avatar updated successfully!");else throw new Error("Invalid response from server")}catch(e){alert(`Failed to update avatar: ${e.message}`),console.error("Error updating avatar:",e.message)}})):console.error("Avatar update elements not found in DOM.")});
