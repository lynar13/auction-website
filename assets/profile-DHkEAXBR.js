import{r as d,a as m,u}from"./profile-CUZq2tJi.js";import"./app-VEMx_aQh.js";async function g(i,o=3,n=2e3){const s="66768252f49364f",r="https://api.imgur.com/3/image";for(let e=1;e<=o;e++)try{const a=new FormData;a.append("image",i);const t=await fetch(r,{method:"POST",headers:{Authorization:`Client-ID ${s}`},body:a});if(!t.ok){const l=await t.json();throw new Error(l.data?.error||"Failed to upload image to Imgur")}return(await t.json()).data.link}catch(a){if(console.error(`Attempt ${e}: ${a.message}`),e<o)console.log(`Retrying in ${n/1e3} seconds...`),await new Promise(t=>setTimeout(t,n));else throw new Error("All attempts to upload the image to Imgur have failed. Please try again later.")}}document.addEventListener("DOMContentLoaded",async()=>{const i=localStorage.getItem("token"),o=JSON.parse(localStorage.getItem("user"));if(!i||!o||!o.name){alert("You must log in to access your profile."),window.location.href="/auction-website/auth/login/index.html";return}try{const e=(await d(o.name)).data;if(e){const{name:a,email:t,avatar:c,credits:l,_count:p}=e;localStorage.setItem("user",JSON.stringify(e)),document.getElementById("username").textContent=a||"Unknown User",document.getElementById("avatar").src=c?.url||"/auction-website/public/images/avatar.jpeg",document.getElementById("credits").textContent=`Credits: ${l||0}`}else throw new Error("Profile data structure is incorrect.")}catch(r){console.error("Error reading profile:",r.message),document.getElementById("credits").textContent="Credits: Unavailable"}try{const e=(await m(o.name)).data||[],a=document.getElementById("userListings");a.innerHTML=e.length?e.map(t=>`
          <div class="card">
            <img src="${t.media?.[0]?.url||"https://via.placeholder.com/400"}" alt="${t.title}" class="card-img-top">
            <div class="card-body">
              <h5 class="card-title">${t.title}</h5>
              <p class="card-text">${t.description||"No description available"}</p>
              <a href="/auction-website/listing/index.html?id=${t.id}" class="btn btn-primary">View Listing</a>
            </div>
          </div>
        `).join(""):"<p>No listings found.</p>"}catch(r){console.error("Error fetching user listings:",r.message),document.getElementById("userListings").innerHTML="<p>Error loading listings. Please try again later.</p>"}const n=document.getElementById("avatarInput"),s=document.getElementById("updateAvatarButton");s&&n?(s.addEventListener("click",()=>n.click()),n.addEventListener("change",async()=>{const r=n.files[0];if(!r){alert("Please select an image to upload.");return}try{document.getElementById("avatar").alt="Uploading...";const e=await g(r),a=await u(o.name,{avatar:{url:e,alt:"User avatar"}});if(a?.avatar?.url)document.getElementById("avatar").src=a.avatar.url,alert("Avatar updated successfully!");else throw new Error("Invalid response from server")}catch(e){alert(`Failed to update avatar: ${e.message}`),console.error("Error updating avatar:",e.message)}})):console.error("Avatar update elements not found in DOM.")});
