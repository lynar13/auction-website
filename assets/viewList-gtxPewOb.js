import{r as a}from"./listing-CzwvzXFI.js";import{A as g,h as u}from"./app-VEMx_aQh.js";import{r as p}from"./profile-CUZq2tJi.js";async function f(n,e){try{const t=await fetch(g(n),{method:"POST",headers:u(!0),body:JSON.stringify({amount:e})});if(!t.ok){const o=await t.json();throw new Error(o.errors?.[0]?.message||"Failed to place bid")}return await t.json()}catch(t){throw console.error("Error placing bid:",t.message),t}}document.addEventListener("DOMContentLoaded",async()=>{const n=y();if(!n){console.error("No listing ID provided."),document.getElementById("title").textContent="Error: No Listing ID",document.getElementById("description").textContent="Please provide a valid listing ID in the URL.";return}await d(),l();try{const t=await a(n);c(t)}catch(t){console.error("Failed to load listing:",t.message),document.getElementById("title").textContent="Error Loading Listing",document.getElementById("description").textContent="There was an issue loading this listing. Please try again later.";return}const e=document.getElementById("bidForm");e&&e.addEventListener("submit",async t=>{t.preventDefault();const o=parseFloat(document.getElementById("bidAmount").value);if(isNaN(o)||o<=0){s("Invalid bid amount. Please enter a valid number.","danger");return}const i=localStorage.getItem("token");if(!i){s("You must be logged in to place a bid.","danger");return}try{const r=await f(n,o,i);s("Bid placed successfully!","success"),await d(),l();const m=await a(n);c(m)}catch(r){console.error("Error placing bid:",r.message),s(r.message,"danger")}})});async function d(){const n=localStorage.getItem("token"),e=JSON.parse(localStorage.getItem("user"));if(!n||!e||!e.name){console.error("User is not logged in or missing essential data.");return}try{const o=(await p(e.name))?.data?.credits??0,i={...e,credits:o};localStorage.setItem("user",JSON.stringify(i))}catch(t){console.error("Failed to update user credits in localStorage:",t.message)}}function l(){const n=JSON.parse(localStorage.getItem("user")),e=document.getElementById("credits");n&&n.credits!==void 0&&e&&(e.textContent=`Your Credits: ${n.credits}`)}function y(){const e=new URLSearchParams(window.location.search).get("id");return e||console.error("No listing ID found in the URL"),e}function s(n,e="info"){const t=document.getElementById("bidMessage");t&&(t.innerHTML=`<div class="alert alert-${e}" role="alert">${n}</div>`,setTimeout(()=>{t.innerHTML=""},3e3))}function c(n){const e=n.data;document.getElementById("title").textContent=e.title||"Untitled",document.getElementById("description").textContent=e.description||"No description available";const t=document.getElementById("mediaGallery");e.media&&e.media.length?t.innerHTML=e.media.map(r=>`<img src="${r.url}" alt="${e.title}" class="img-fluid mb-2">`).join(""):t.innerHTML="<p>No media available.</p>";const o=document.getElementById("endsAt");o.textContent=e.endsAt?`Ends At: ${new Date(e.endsAt).toLocaleString()}`:"No expiration date";const i=document.getElementById("count");e._count&&typeof e._count.bids=="number"?i.textContent=`Bids: ${e._count.bids}`:i.textContent="No bids available"}
